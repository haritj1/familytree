<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family Network Archive</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.26.0/cytoscape.min.js"></script>
    <style>
        :root {
            --male-color: #3498db;
            --female-color: #e91e63;
            --bg-color: #f0f2f5;
            --sidebar-width: 350px;
        }

        body { margin: 0; overflow: hidden; background: var(--bg-color); font-family: 'Segoe UI', Tahoma, sans-serif; }

        /* --- Security Gate --- */
        #password-overlay { position: fixed; inset: 0; background: #2c3e50; z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center; color: white; }
        #password-overlay input { padding: 12px; margin: 10px; border-radius: 4px; border: none; text-align: center; width: 220px; font-size: 16px; }

        /* --- UI Layer --- */
        .ui-layer { position: fixed; z-index: 1000; padding: 20px; display: flex; flex-direction: column; gap: 10px; pointer-events: none; }
        .ui-layer * { pointer-events: auto; }
        .btn-group { display: flex; gap: 8px; }
        .action-btn { cursor: pointer; background: #333; color: white; border: none; padding: 8px 16px; border-radius: 4px; font-weight: bold; font-size: 12px; }

        /* --- View Containers --- */
        #cy { width: 100vw; height: 100vh; display: block; background: var(--bg-color); }
        #gallery-wrapper { position: fixed; inset: 0; background: var(--bg-color); z-index: 500; padding: 100px 50px; overflow-y: auto; display: none; }
        .gallery-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 20px; }
        .gallery-item { background: white; padding: 10px; border-radius: 8px; text-align: center; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .gallery-item img { width: 100%; height: 160px; object-fit: cover; border-radius: 4px; }

        /* --- Sidebar --- */
        #sidebar { position: fixed; top: 0; right: -400px; width: var(--sidebar-width); height: 100%; background: white; z-index: 2000; padding: 30px; transition: 0.3s; box-shadow: -5px 0 15px rgba(0,0,0,0.1); overflow-y: auto; box-sizing: border-box; }
        #sidebar.open { right: 0; }
        .close-sidebar { cursor: pointer; float: right; font-size: 24px; color: #888; font-weight: bold; }
        #side-img { width: 100%; height: 250px; object-fit: cover; border-radius: 10px; margin-bottom: 20px; background: #eee; }

        .hidden { display: none !important; }
    </style>
</head>
<body>

<div id="password-overlay">
    <h2>Family Vault: Network View</h2>
    <input type="password" id="passInput" placeholder="Enter Access Code">
    <button class="action-btn" onclick="checkPassword()" style="background:#27ae60;">Unlock Archive</button>
</div>

<div id="sidebar">
    <span class="close-sidebar" onclick="closeSidebar()">&times;</span>
    <img id="side-img" src="">
    <h2 id="side-name" style="margin-top:0;"></h2>
    <p id="side-meta" style="color:#666;"></p>
    <hr style="border:0; border-top:1px solid #eee;">
    <p id="side-bio" style="line-height:1.6; color:#444;"></p>
</div>

<div class="ui-layer">
    <div class="btn-group">
        <button class="action-btn" onclick="toggleView('graph')">Network Graph</button>
        <button class="action-btn" onclick="toggleView('gallery')">Photo Gallery</button>
    </div>
    <div class="btn-group">
        <button class="action-btn" onclick="filterEdges('parent')" style="background:#e67e22;">Direct Bloodline</button>
        <button class="action-btn" onclick="filterEdges('all')" style="background:#7f8c8d;">Show All Links</button>
    </div>
    <div class="btn-group">
        <button class="action-btn" onclick="reLayout()">Rearrange</button>
    </div>
</div>

<div id="cy"></div>

<div id="gallery-wrapper">
    <div class="gallery-grid" id="gallery-content"></div>
</div>

<script>
    const FAMILY_CODE = "Network2025"; // Set your password here
    let cy;
    let globalData;

    function checkPassword() {
        if(document.getElementById('passInput').value === FAMILY_CODE) {
            document.getElementById('password-overlay').classList.add('hidden');
            initApp();
        } else { alert("Incorrect Code"); }
    }

    function initApp() {
        fetch('familyData.json')
            .then(res => res.json())
            .then(data => {
                globalData = data;
                cy = cytoscape({
                    container: document.getElementById('cy'),
                    elements: data,
                    style: [
                        {
                            selector: 'node',
                            style: {
                                'label': 'data(name)',
                                'width': 85, 'height': 85,
                                'background-image': 'data(img)',
                                'background-fit': 'cover',
                                'border-width': 4,
                                'border-color': (n) => n.data('gender') === 'male' ? '#3498db' : '#e91e63',
                                'font-size': '12px', 'text-valign': 'bottom', 'text-margin-y': 8,
                                'color': '#333', 'text-outline-width': 2, 'text-outline-color': '#fff'
                            }
                        },
                        {
                            selector: 'edge',
                            style: {
                                'width': 3, 'line-color': '#bbb', 'curve-style': 'bezier',
                                'target-arrow-shape': 'triangle', 'target-arrow-color': '#bbb',
                                'label': 'data(label)', 'font-size': '10px', 'color': '#888',
                                'text-background-opacity': 1, 'text-background-color': '#fff',
                                'text-background-padding': '2px'
                            }
                        },
                        {
                            selector: ':selected',
                            style: { 'border-color': '#f1c40f', 'border-width': 6 }
                        }
                    ],
                    layout: { name: 'breadthfirst', directed: true, spacingFactor: 1.5 }
                });

                cy.on('tap', 'node', (evt) => showDetails(evt.target.data()));
            });
    }

    function toggleView(view) {
        document.getElementById('cy').style.display = view === 'graph' ? 'block' : 'none';
        document.getElementById('gallery-wrapper').style.display = view === 'gallery' ? 'block' : 'none';
        if(view === 'gallery') buildGallery();
    }

    function filterEdges(type) {
        if(type === 'all') {
            cy.edges().style('display', 'element');
        } else {
            cy.edges().forEach(edge => {
                edge.style('display', edge.data('type') === type ? 'element' : 'none');
            });
        }
    }

    function reLayout() {
        cy.layout({ name: 'cose', animationDuration: 1000 }).run();
    }

    function buildGallery() {
        const content = document.getElementById('gallery-content');
        content.innerHTML = "";
        globalData.nodes.forEach(node => {
            const p = node.data;
            content.innerHTML += `
                <div class="gallery-item" onclick='showDetails(${JSON.stringify(p)})'>
                    <img src="${p.img}" onerror="this.src='https://via.placeholder.com/150'">
                    <div style="font-weight:bold; margin-top:8px;">${p.name}</div>
                </div>`;
        });
    }

    function showDetails(p) {
        document.getElementById('side-img').src = p.img;
        document.getElementById('side-name').innerText = p.name;
        document.getElementById('side-meta').innerText = `Born: ${p.born || 'Unknown'} | ${p.job || ''}`;
        document.getElementById('side-bio').innerText = p.bio || "Biography details not available.";
        document.getElementById('sidebar').classList.add('open');
    }

    function closeSidebar() { document.getElementById('sidebar').classList.remove('open'); }
</script>
</body>
</html>
