<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>8-Generation Family Legacy</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.26.0/cytoscape.min.js"></script>
    <style>
        :root {
            --male: #3498db;
            --female: #e91e63;
            --bg: #f8f9fa;
        }

        body { margin: 0; overflow: hidden; background: var(--bg); font-family: 'Segoe UI', sans-serif; }
        #cy { width: 100vw; height: 100vh; display: block; }

        /* UI Panel */
        .ui-panel {
            position: fixed; top: 20px; left: 20px; z-index: 1000;
            background: white; padding: 15px; border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 280px;
        }
        .search-box { display: flex; gap: 5px; margin-bottom: 10px; }
        input { padding: 8px; border: 1px solid #ddd; border-radius: 4px; flex-grow: 1; outline: none; }
        button { cursor: pointer; background: #2c3e50; color: white; border: none; padding: 8px 12px; border-radius: 4px; font-weight: bold; }
        
        /* Sidebar */
        #sidebar { 
            position: fixed; top: 0; right: -380px; width: 380px; height: 100%; 
            background: white; transition: 0.3s ease; padding: 30px; box-sizing: border-box;
            box-shadow: -5px 0 15px rgba(0,0,0,0.1); z-index: 2000; overflow-y: auto;
        }
        #sidebar.open { right: 0; }
        #side-img { width: 100%; height: 250px; object-fit: cover; border-radius: 8px; background: #eee; }
        .close-btn { float: right; cursor: pointer; font-size: 24px; color: #aaa; }
    </style>
</head>
<body>

<div class="ui-panel">
    <h3 style="margin:0 0 10px 0;">8-Generation Archive</h3>
    <div class="search-box">
        <input type="text" id="searchInput" placeholder="Search name..." onkeypress="if(event.key === 'Enter') doSearch()">
        <button onclick="doSearch()">Go</button>
    </div>
    <div style="display:flex; gap:5px;">
        <button onclick="cy.fit()" style="flex:1">View All</button>
        <button onclick="clearAll()" style="flex:1; background:#7f8c8d;">Reset</button>
    </div>
    <p style="font-size: 11px; color: #777; margin-top: 10px; line-height: 1.4;">
        • Click person for details<br>
        • Click 2 people to find lineage path
    </p>
</div>

<div id="sidebar">
    <span class="close-btn" onclick="closeSidebar()">&times;</span>
    <img id="side-img" src="">
    <h2 id="side-name"></h2>
    <p id="side-meta" style="font-weight:bold; color:#666;"></p>
    <hr style="border:0; border-top:1px solid #eee;">
    <p id="side-bio"></p>
</div>

<div id="cy"></div>

<script>
    let cy;
    let pathNodes = [];

    document.addEventListener("DOMContentLoaded", () => {
        fetch('familyData.json')
            .then(res => res.json())
            .then(data => {
                cy = cytoscape({
                    container: document.getElementById('cy'),
                    elements: data,
                    style: [
                        {
                            selector: 'node',
                            style: {
                                'label': 'data(name)',
                                'width': 60, 'height': 60,
                                'background-image': 'data(img)',
                                'background-fit': 'cover',
                                'border-width': 3,
                                'border-color': (n) => n.data('gender') === 'male' ? '#3498db' : '#e91e63',
                                'font-size': '11px', 'text-valign': 'bottom', 'text-margin-y': 5,
                                'text-outline-width': 2, 'text-outline-color': '#fff'
                            }
                        },
                        {
                            selector: ':parent',
                            style: {
                                'background-opacity': 0.05,
                                'background-color': '#2c3e50',
                                'border-color': '#bdc3c7',
                                'border-style': 'solid',
                                'shape': 'roundrectangle',
                                'padding': 40,
                                'label': 'data(name)',
                                'text-valign': 'top',
                                'font-weight': 'bold',
                                'font-size': '14px'
                            }
                        },
                        {
                            selector: 'edge',
                            style: {
                                'width': 2, 'line-color': '#bbb',
                                'target-arrow-shape': 'triangle', 'target-arrow-color': '#bbb',
                                'curve-style': 'taxi', 'taxi-direction': 'vertical'
                            }
                        },
                        {
                            selector: '.highlighted',
                            style: { 'line-color': '#f1c40f', 'target-arrow-color': '#f1c40f', 'width': 6, 'z-index': 999 }
                        }
                    ],
                    layout: { 
                        name: 'breadthfirst', 
                        directed: true, 
                        spacingFactor: 1.3, 
                        padding: 100 
                    }
                });

                cy.on('tap', 'node', (evt) => {
                    const node = evt.target;
                    if (node.isParent()) return;

                    showSidebar(node.data());
                    
                    pathNodes.push(node);
                    node.style('border-width', 8);

                    if (pathNodes.length === 2) {
                        const aStar = cy.elements().aStar({ root: pathNodes[0], goal: pathNodes[1] });
                        if (aStar.found) aStar.path.addClass('highlighted');
                        pathNodes = [];
                    }
                });
            });
    });

    function doSearch() {
        const term = document.getElementById('searchInput').value.toLowerCase();
        if (!term) return;
        const matches = cy.nodes().filter(n => n.data('name') && n.data('name').toLowerCase().includes(term));
        if (matches.length > 0) {
            cy.animate({ center: { eles: matches }, zoom: 1.5 }, { duration: 500 });
            matches.flashClass('highlighted', 1000);
        }
    }

    function showSidebar(p) {
        document.getElementById('side-img').src = p.img || '';
        document.getElementById('side-name').innerText = p.name;
        document.getElementById('side-meta').innerText = `Born: ${p.born || '????'}`;
        document.getElementById('side-bio').innerText = p.bio || "No biography available.";
        document.getElementById('sidebar').classList.add('open');
    }

    function closeSidebar() { document.getElementById('sidebar').classList.remove('open'); }
    function clearAll() { 
        cy.elements().removeClass('highlighted'); 
        cy.nodes().style('border-width', 3);
        pathNodes = [];
    }
</script>
</body>
</html>
